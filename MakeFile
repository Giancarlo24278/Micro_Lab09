%%writefile Makefile

# Makefile para Chat-Box CUDA - Smart Home
# CC3086 - Laboratorio 9

# Compilador
NVCC = nvcc

# Flags de compilación (ajustado para compatibilidad)
NVCCFLAGS = -O3 -std=c++17
NVCCFLAGS += -Xcompiler -Wall -Xcompiler -Wextra

# Archivos
TARGET = chatbox_cuda
SOURCES = main.cu

# Reglas
all: $(TARGET)

$(TARGET): $(SOURCES)
	@echo "Compilando $(TARGET)..."
	$(NVCC) $(NVCCFLAGS) $(SOURCES) -o $(TARGET)
	@echo "Compilación exitosa!"

# Ejecutar
run: $(TARGET)
	@echo "Ejecutando $(TARGET)..."
	@echo "================================"
	./$(TARGET)

# Limpiar
clean:
	@echo "Limpiando archivos..."
	rm -f $(TARGET) *.o
	@echo "Limpieza completa"

# Profile con nvprof (legacy) o ncu (moderno)
profile: $(TARGET)
	@echo "Perfilando con nvprof..."
	nvprof --print-gpu-trace ./$(TARGET) 2>&1 || \
	ncu --target-processes all ./$(TARGET)

# Verificar CUDA
check:
	@echo "Verificando instalación CUDA..."
	@$(NVCC) --version || echo "NVCC no encontrado"
	@nvidia-smi || echo "nvidia-smi no encontrado"

.PHONY: all run clean profile check
